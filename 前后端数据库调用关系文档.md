# æµ™åClassroomç³»ç»Ÿ - å‰åç«¯æ•°æ®åº“è°ƒç”¨å…³ç³»æ–‡æ¡£

## ğŸ“‹ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
å‰ç«¯ (Vue.js) â†â†’ åç«¯API (Node.js/Express) â†â†’ æ•°æ®åº“ (MySQL)
     â†“                    â†“                      â†“
  ç»„ä»¶è°ƒç”¨             è·¯ç”±å¤„ç†               æ¨¡å‹æ“ä½œ
  Storeç®¡ç†           ä¸šåŠ¡é€»è¾‘               SQLæŸ¥è¯¢
```

## ğŸ”„ å®Œæ•´è°ƒç”¨é“¾è·¯ç¤ºä¾‹ï¼šå…¬å‘ŠåŠŸèƒ½

### 1. å‰ç«¯ç»„ä»¶å±‚ (Vue Component)

#### 1.1 ç»„ä»¶å®šä¹‰å’Œå±æ€§ä¼ é€’
```vue
<!-- AnnouncementBoard.vue -->
<template>
  <div class="announcement-board">
    <form @submit.prevent="addAnnouncement">
      <input v-model="newAnnouncement" placeholder="è¾“å…¥æ–°å…¬å‘Šå†…å®¹..." />
      <button type="submit">æ·»åŠ </button>
    </form>
  </div>
</template>

<script setup>
// 1. å®šä¹‰ç»„ä»¶å±æ€§ï¼Œæ¥æ”¶çˆ¶ç»„ä»¶ä¼ é€’çš„classId
const props = defineProps({ classId: [String, Number] })

// 2. å¼•å…¥çŠ¶æ€ç®¡ç†
import { useClassStore } from '@/stores/classStore'
const classStore = useClassStore()

// 3. å®šä¹‰å“åº”å¼æ•°æ®
const announcements = ref([])
const newAnnouncement = ref('')
</script>
```

#### 1.2 ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
```javascript
// 4. ç»„ä»¶æŒ‚è½½æ—¶è°ƒç”¨APIè·å–æ•°æ®
onMounted(async () => {
  try {
    // è°ƒç”¨storeæ–¹æ³•ï¼Œä¼ å…¥classId
    announcements.value = await classStore.fetchAnnouncements(props.classId)
    console.log('ä»æ•°æ®åº“åŠ è½½å…¬å‘Šæ•°æ®:', announcements.value)
  } catch (error) {
    console.error('åŠ è½½å…¬å‘Šæ•°æ®å¤±è´¥:', error)
    announcements.value = []
  }
})
```

### 2. å‰ç«¯çŠ¶æ€ç®¡ç†å±‚ (Pinia Store)

#### 2.1 Storeæ–¹æ³•å®šä¹‰
```javascript
// classStore.js
export const useClassStore = defineStore('classes', () => {
  // 5. å®šä¹‰APIåŸºç¡€URL
  const API_BASE_URL = 'http://localhost:3001/api'
  
  // 6. è·å–å…¬å‘Šåˆ—è¡¨æ–¹æ³•
  const fetchAnnouncements = async (classId) => {
    try {
      loading.value = true
      error.value = null
      // å‘é€HTTP GETè¯·æ±‚åˆ°åç«¯API
      const response = await fetch(`${API_BASE_URL}/announcements/class/${classId}`)
      if (!response.ok) {
        throw new Error('è·å–å…¬å‘Šå¤±è´¥')
      }
      return await response.json()
    } catch (err) {
      error.value = err.message
      console.error('è·å–å…¬å‘Šå¤±è´¥:', err)
      return []
    } finally {
      loading.value = false
    }
  }
  
  // 7. åˆ›å»ºå…¬å‘Šæ–¹æ³•
  const createAnnouncement = async (announcementData) => {
    try {
      const response = await saveToAPI('POST', `${API_BASE_URL}/announcements`, announcementData)
      return response
    } catch (err) {
      console.error('åˆ›å»ºå…¬å‘Šå¤±è´¥:', err)
      throw err
    }
  }
})
```

#### 2.2 é€šç”¨APIè°ƒç”¨æ–¹æ³•
```javascript
// 8. é€šç”¨APIè°ƒç”¨å°è£…
const saveToAPI = async (method, url, data = null) => {
  try {
    const options = {
      method,
      headers: {
        'Content-Type': 'application/json',
      }
    }
    if (data) {
      options.body = JSON.stringify(data)
    }
    
    const response = await fetch(url, options)
    if (!response.ok) {
      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`)
    }
    return await response.json()
  } catch (err) {
    error.value = err.message
    throw err
  }
}
```

### 3. åç«¯è·¯ç”±å±‚ (Express Router)

#### 3.1 è·¯ç”±å®šä¹‰å’Œä¸­é—´ä»¶
```javascript
// announcements.js
const express = require('express');
const router = express.Router();
// 9. å¯¼å…¥æ•°æ®åº“æ¨¡å‹
const { Announcement, Class } = require('../models');

// 10. è·å–å…¬å‘Šåˆ—è¡¨è·¯ç”±
router.get('/class/:classId', async (req, res) => {
  try {
    // 11. ä»URLå‚æ•°è·å–classId
    const classId = req.params.classId;
    
    // 12. è°ƒç”¨æ•°æ®åº“æ¨¡å‹æŸ¥è¯¢æ•°æ®
    const announcements = await Announcement.findAll({
      where: { classId: classId },
      order: [['createdAt', 'DESC']]
    });
    
    // 13. è¿”å›JSONå“åº”
    res.json(announcements);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

// 14. åˆ›å»ºå…¬å‘Šè·¯ç”±
router.post('/', async (req, res) => {
  try {
    // 15. ä»è¯·æ±‚ä½“è·å–æ•°æ®
    const { text, filePath, classId } = req.body;

    // 16. æ•°æ®éªŒè¯
    if (!text || !classId) {
      return res.status(400).json({ error: 'å…¬å‘Šå†…å®¹å’Œç­çº§IDä¸èƒ½ä¸ºç©º' });
    }

    // 17. è°ƒç”¨æ•°æ®åº“æ¨¡å‹åˆ›å»ºè®°å½•
    const announcement = await Announcement.create({
      text,
      filePath: filePath || '',
      classId
    });

    // 18. è¿”å›åˆ›å»ºçš„è®°å½•
    res.status(201).json(announcement);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

### 4. æ•°æ®åº“æ¨¡å‹å±‚ (Sequelize ORM)

#### 4.1 æ¨¡å‹å®šä¹‰
```javascript
// Announcement.js
const { DataTypes } = require('sequelize');
const sequelize = require('../config/database');

// 19. å®šä¹‰å…¬å‘Šæ¨¡å‹
const Announcement = sequelize.define('Announcement', {
  id: {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  text: {
    type: DataTypes.TEXT,
    allowNull: false,
    comment: 'å…¬å‘Šå†…å®¹'
  },
  filePath: {
    type: DataTypes.STRING,
    allowNull: true,
    comment: 'æ–‡ä»¶è·¯å¾„æˆ–URL'
  },
  classId: {
    type: DataTypes.INTEGER,
    allowNull: false,
    comment: 'å…³è”ç­çº§ID'
  }
}, {
  tableName: 'announcements',
  comment: 'å…¬å‘Šè¡¨'
});

module.exports = Announcement;
```

#### 4.2 æ•°æ®åº“è¿æ¥é…ç½®
```javascript
// database.js
const { Sequelize } = require('sequelize');

// 20. åˆ›å»ºMySQLæ•°æ®åº“è¿æ¥
const sequelize = new Sequelize({
  dialect: 'mysql',
  host: process.env.DB_HOST || 'localhost',
  port: process.env.DB_PORT || 3306,
  database: process.env.DB_NAME || 'zj_classroom',
  username: process.env.DB_USER || 'root',
  password: process.env.DB_PASSWORD || '',
  logging: false,
  pool: {
    max: 10,
    min: 0,
    acquire: 30000,
    idle: 10000
  },
  define: {
    charset: 'utf8mb4',
    collate: 'utf8mb4_unicode_ci',
    timestamps: true, // è‡ªåŠ¨æ·»åŠ  createdAt å’Œ updatedAt
    underscored: false
  }
});
```

#### 4.3 æ¨¡å‹å…³è”å®šä¹‰
```javascript
// index.js
const Class = require('./Class');
const Announcement = require('./Announcement');

// 21. å®šä¹‰æ¨¡å‹å…³è”å…³ç³»
Class.hasMany(Announcement, { foreignKey: 'classId', as: 'announcements' });
Announcement.belongsTo(Class, { foreignKey: 'classId', as: 'class' });
```

## ğŸ”„ å®Œæ•´æ•°æ®æµç¤ºä¾‹

### åœºæ™¯ï¼šç”¨æˆ·æ·»åŠ æ–°å…¬å‘Š

1. **ç”¨æˆ·æ“ä½œ**ï¼šåœ¨å…¬å‘Šæ è¾“å…¥"æµ‹è¯•å…¬å‘Š"å¹¶ç‚¹å‡»æ·»åŠ æŒ‰é’®

2. **å‰ç«¯ç»„ä»¶**ï¼š
   ```javascript
   // AnnouncementBoard.vue
   async function addAnnouncement() {
     if (!newAnnouncement.value.trim()) return
     
     try {
       // å‡†å¤‡æ•°æ®
       const announcementData = {
         text: newAnnouncement.value.trim(),
         filePath: newAnnouncementFilePath.value.trim(),
         classId: props.classId  // ä»çˆ¶ç»„ä»¶è·å–
       }
       
       // è°ƒç”¨storeæ–¹æ³•
       const newAnnouncementObj = await classStore.createAnnouncement(announcementData)
       
       // æ›´æ–°æœ¬åœ°çŠ¶æ€
       announcements.value.unshift(newAnnouncementObj)
       
       // æ¸…ç©ºè¾“å…¥æ¡†
       newAnnouncement.value = ''
     } catch (error) {
       console.error('æ·»åŠ å…¬å‘Šå¤±è´¥:', error)
       alert('æ·»åŠ å…¬å‘Šå¤±è´¥ï¼Œè¯·é‡è¯•')
     }
   }
   ```

3. **Storeè°ƒç”¨**ï¼š
   ```javascript
   // classStore.js
   const createAnnouncement = async (announcementData) => {
     // å‘é€POSTè¯·æ±‚åˆ°åç«¯API
     const response = await saveToAPI('POST', `${API_BASE_URL}/announcements`, announcementData)
     return response
   }
   ```

4. **HTTPè¯·æ±‚**ï¼š
   ```http
   POST http://localhost:3001/api/announcements
   Content-Type: application/json
   
   {
     "text": "æµ‹è¯•å…¬å‘Š",
     "filePath": "",
     "classId": 1
   }
   ```

5. **åç«¯è·¯ç”±å¤„ç†**ï¼š
   ```javascript
   // announcements.js
   router.post('/', async (req, res) => {
     const { text, filePath, classId } = req.body;
     
     // æ•°æ®éªŒè¯
     if (!text || !classId) {
       return res.status(400).json({ error: 'å…¬å‘Šå†…å®¹å’Œç­çº§IDä¸èƒ½ä¸ºç©º' });
     }
     
     // è°ƒç”¨æ•°æ®åº“æ¨¡å‹
     const announcement = await Announcement.create({
       text,
       filePath: filePath || '',
       classId
     });
     
     res.status(201).json(announcement);
   });
   ```

6. **æ•°æ®åº“æ“ä½œ**ï¼š
   ```sql
   -- Sequelizeè‡ªåŠ¨ç”Ÿæˆçš„SQL
   INSERT INTO `announcements` 
   (`id`, `text`, `filePath`, `classId`, `createdAt`, `updatedAt`) 
   VALUES 
   (DEFAULT, 'æµ‹è¯•å…¬å‘Š', '', 1, NOW(), NOW());
   ```

7. **å“åº”è¿”å›**ï¼š
   ```json
   {
     "id": 1,
     "text": "æµ‹è¯•å…¬å‘Š",
     "filePath": "",
     "classId": 1,
     "createdAt": "2025-09-20T05:14:40.000Z",
     "updatedAt": "2025-09-20T05:14:40.000Z"
   }
   ```

8. **å‰ç«¯æ›´æ–°**ï¼š
   ```javascript
   // æ–°å…¬å‘Šæ·»åŠ åˆ°åˆ—è¡¨é¡¶éƒ¨
   announcements.value.unshift(newAnnouncementObj)
   ```

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### announcementsè¡¨
```sql
CREATE TABLE `announcements` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `text` text NOT NULL COMMENT 'å…¬å‘Šå†…å®¹',
  `filePath` varchar(255) DEFAULT NULL COMMENT 'æ–‡ä»¶è·¯å¾„æˆ–URL',
  `classId` int(11) NOT NULL COMMENT 'å…³è”ç­çº§ID',
  `createdAt` datetime NOT NULL,
  `updatedAt` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `announcements_classId` (`classId`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### 1. å‰ç«¯è¯­æ³•
- **Vue 3 Composition API**ï¼š`<script setup>`
- **å“åº”å¼æ•°æ®**ï¼š`ref()`, `reactive()`
- **ç”Ÿå‘½å‘¨æœŸé’©å­**ï¼š`onMounted()`
- **çŠ¶æ€ç®¡ç†**ï¼šPinia Store
- **HTTPè¯·æ±‚**ï¼š`fetch()` API

### 2. åç«¯è¯­æ³•
- **Expressè·¯ç”±**ï¼š`router.get()`, `router.post()`
- **ä¸­é—´ä»¶**ï¼š`express.json()`
- **å¼‚æ­¥å¤„ç†**ï¼š`async/await`
- **é”™è¯¯å¤„ç†**ï¼š`try/catch`

### 3. æ•°æ®åº“è¯­æ³•
- **ORMæ¡†æ¶**ï¼šSequelize
- **æ¨¡å‹å®šä¹‰**ï¼š`sequelize.define()`
- **æŸ¥è¯¢æ–¹æ³•**ï¼š`findAll()`, `create()`, `update()`, `destroy()`
- **å…³è”å…³ç³»**ï¼š`hasMany()`, `belongsTo()`

## ğŸš€ å¯åŠ¨é¡ºåº

1. **å¯åŠ¨æ•°æ®åº“**ï¼šMySQLæœåŠ¡
2. **å¯åŠ¨åç«¯**ï¼š`cd backend && npm start`
3. **å¯åŠ¨å‰ç«¯**ï¼š`cd web && npm run serve`
4. **è®¿é—®åº”ç”¨**ï¼š`http://localhost:8080`

## ğŸ“ æ€»ç»“

è¿™ä¸ªç³»ç»Ÿé‡‡ç”¨äº†ç»å…¸çš„ä¸‰å±‚æ¶æ„ï¼š
- **è¡¨ç¤ºå±‚**ï¼šVue.jså‰ç«¯ç»„ä»¶
- **ä¸šåŠ¡é€»è¾‘å±‚**ï¼šNode.js/Expressåç«¯API
- **æ•°æ®è®¿é—®å±‚**ï¼šMySQLæ•°æ®åº“ + Sequelize ORM

æ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£åˆ†å·¥ï¼Œé€šè¿‡HTTP APIè¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨JSONæ ¼å¼äº¤æ¢æ•°æ®ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚
